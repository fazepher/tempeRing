<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Perform a Metropolis-Hastings step on one or more states.
If we already have proposed states and all log-density factors we can call mh_step().
If we wish to first sample a proposal and then give the step, we can use mh_sampling_step().
Both metropolis_step() and metropolis_sampling_step() are just wrappers for symmetric
transition kernels.

"><title>Metropolis-Hastings Step — mh_step • tempeRing</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Metropolis-Hastings Step — mh_step"><meta property="og:description" content="Perform a Metropolis-Hastings step on one or more states.
If we already have proposed states and all log-density factors we can call mh_step().
If we wish to first sample a proposal and then give the step, we can use mh_sampling_step().
Both metropolis_step() and metropolis_sampling_step() are just wrappers for symmetric
transition kernels.

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tempeRing</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Invariant_Kernels.html">Invariant Kernels</a>
    <a class="dropdown-item" href="../articles/Measure_Theory.html">Basic Measure Theory Preliminaries</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fazepher/tempeRing/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Metropolis-Hastings Step</h1>
      <small class="dont-index">Source: <a href="https://github.com/fazepher/tempeRing/blob/HEAD/R/Metropolis_Hastings.R" class="external-link"><code>R/Metropolis_Hastings.R</code></a></small>
      <div class="d-none name"><code>mh_step.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Perform a Metropolis-Hastings step on one or more states.</p><ul><li><p>If we already have proposed states and all log-density factors we can call <code>mh_step()</code>.</p></li>
<li><p>If we wish to first sample a proposal and then give the step, we can use <code>mh_sampling_step()</code>.</p></li>
<li><p>Both <code>metropolis_step()</code> and <code>metropolis_sampling_step()</code> are just wrappers for symmetric
transition kernels.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mh_step</span><span class="op">(</span></span>
<span>  <span class="va">x_curr</span>,</span>
<span>  <span class="va">x_prop</span>,</span>
<span>  <span class="va">l_curr</span>,</span>
<span>  <span class="va">l_prop</span>,</span>
<span>  lq_c2p <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  lq_p2c <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  do_checks <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">metropolis_step</span><span class="op">(</span><span class="va">x_curr</span>, <span class="va">x_prop</span>, <span class="va">l_curr</span>, <span class="va">l_prop</span>, do_checks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mh_sampling_step</span><span class="op">(</span></span>
<span>  <span class="va">x_curr</span>,</span>
<span>  <span class="va">l_curr</span>,</span>
<span>  <span class="va">l_target</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">sampler</span>,</span>
<span>  sampler_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lq_sampler <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lq_sampler_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  do_checks <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">metropolis_sampling_step</span><span class="op">(</span></span>
<span>  <span class="va">x_curr</span>,</span>
<span>  <span class="va">l_curr</span>,</span>
<span>  <span class="va">l_target</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">sampler</span>,</span>
<span>  <span class="va">sampler_args</span>,</span>
<span>  do_checks <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x_curr, x_prop</dt>
<dd><p>Two vectors or matrices of current and proposed states. See <code>Dimension</code> for
how to specify these to correctly identify the dimension of the state space.</p></dd>


<dt>l_curr, l_prop</dt>
<dd><p>Vectors of values of log-densities, possibly up to proportionality, of the
current and proposed states.</p></dd>


<dt>lq_c2p, lq_p2c</dt>
<dd><p>(Optional) Vectors of transition log-densities, possibly up to proportionality.
The suffix <code>_c2p</code> corresponds to transitions from the <strong>c</strong>urrent towards the <strong>p</strong>roposed state(s),
while the suffix <code>_p2c</code> contains the reversed transitions. If these values are ommited (the default),
the Hastings ratio becomes standard Metropolis.</p></dd>


<dt>do_checks</dt>
<dd><p>If TRUE (the default), runs some preliminary checks for arguments validity.
It may be set to FALSE if one is sure that the arguments are correct and doesn't want to incurr in
slight overhead.</p></dd>


<dt>l_target</dt>
<dd><p>For <code>mh_sampling_step()</code>, a function that computes the log-density of the target,
possibly up to proportionality. It must accept <code>x_curr</code> as its first argument and its returned
value must be a valid corresponding <code>l_prop</code>.</p></dd>


<dt>...</dt>
<dd><p>Arguments to be passed on to the <code>l_target</code> function.</p></dd>


<dt>sampler</dt>
<dd><p>For <code>mh_sampling_step()</code>, a sampling function whose first argument is compatible with
<code>x_curr</code> and returns appropriate <code>x_prop</code> states.</p></dd>


<dt>sampler_args</dt>
<dd><p>A list of further arguments to be passed on to the <code>sampler</code></p></dd>


<dt>lq_sampler</dt>
<dd><p>(Optional) For <code>mh_sampling_step()</code>, a function that computes the transition log-densities
for the <code>sampler()</code>. It first two arguments must be conformable with <code>x_curr</code> and <code>x_prop</code> as
it will be used to compute the relevant <code>lq_c2p</code> and <code>lq_p2c</code> factors of the MH step.
If ommited, it is assumed that it is symmetric and, hence, it's not needed.</p></dd>


<dt>lq_sampler_args</dt>
<dd><p>A list of further arguments to be passed on to <code>lq_sampler</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list containing the results of the Metropolis-Hastings step:</p><ul><li><p><code>x_next</code>:
The next values of the chain. This object has the same structure as the input <code>x_curr</code>.
For each proposal, it contains the corresponding <code>x_prop</code> or <code>x_curr</code> values depending on
their acceptance or rejection.</p></li>
<li><p><code>l_next</code>:
A vector of log-density values corresponding to <code>x_next</code> elements.
These may be re-used in the next iteration of a chain to avoid wasting resources in what
usually is an expensive computation.</p></li>
<li><p><code>accepted</code>:
A vector specifying whether or not each of the proposals was accepted or rejected.
May be useful for acceptance rate monitoring.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="dimension">Dimension<a class="anchor" aria-label="anchor" href="#dimension"></a></h2>
    <p>We want to perform MH steps on <code>C</code> states, so all log-density inputs are vectors of length <code>C</code>.
The only exception is for the transition log-densities that by default are set both to <code>0</code>
to signal that we are dealing with symmetrical Metropolis steps.
Similarly, the <code>accepted</code> and <code>l_next</code> elements of the output list are always vectors of length <code>C</code>.</p>
<p>States, on the other hand, live in a space of dimension <code>d</code>. There are thus 3 big combinations:</p><ul><li><p><code>C</code>=1: We want to perform a step on a single d-dimensional state. Without loss of generality,
<code>x_curr</code> and <code>x_prop</code> are two vectors of length <code>d</code>.</p></li>
<li><p><code>C</code>&gt;1, <code>d</code>&gt;1: We want to perform a step on each of several multidimensional states.
Here, <code>x_curr</code> and <code>x_prop</code> are two <code>C</code> by <code>d</code> matrices, so that each state is a row vector.</p></li>
<li><p><code>C</code>&gt;1, <code>d</code>=1: We want to perform a step on each of several 1-dimensional states.
Here, all inputs can be vectors of length <code>C</code> or, alternatively,
<code>x_curr</code> and <code>x_prop</code> may be two <code>C</code> by <code>1</code> matrices.</p></li>
</ul><p>The output element <code>x_next</code> is always of the same structure as the input <code>x_curr</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="the-metropolis-hastings-ratio">The Metropolis-Hastings Ratio<a class="anchor" aria-label="anchor" href="#the-metropolis-hastings-ratio"></a></h2>
    <p>The usual form of the MH acceptance probability \(\alpha = min{1, MH ratio}\),
relies on the ratio
$$ MH ratio = \pi(x_1) q(x_0|x_1) / \pi(x_0) q(x_1|x_0) $$
to satisfy detail balance.
For numerical reasons, we wish to work on the log scale and the ratio becomes
$$ MH log-ratio =  l(x_1) + lq(x_0|x_1) - l(x_0) - lq(x_1|x_0) $$
Whenever the transition kernel is symmetrical (i.e. \(q(x_0|x_1)=q(x_1|x_0)\))
we can omit those terms from the calculation and recover the original Metropolis et. al ratio.
This is the default assumption of the <code>mh_step()</code> function.</p><div class="section">
<h3 id="note-on-proportionality">Note on proportionality<a class="anchor" aria-label="anchor" href="#note-on-proportionality"></a></h3>


<p>We want to also take advantage of the cancellation of normalizing constants so that we only need
the log-densities <em>up to a constant of proportionality</em>. Note however that this refers
to the <strong>same</strong> constant. While there are usually no problems when it comes to the target density,
care must be taken with general transition kernels as they may have different
underlying densities whose normalizing constants don't cancel.</p>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Fernando A. Zepeda Herrera.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

